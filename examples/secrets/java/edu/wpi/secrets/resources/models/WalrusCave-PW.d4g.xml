<?xml version="1.0"?>
<model about="urn:secrets.wpi.edu:models:WalrusCave"
       xmlns="http://www.cs.wpi.edu/~rich/d4g"
       xmlns:t="http://www.cs.wpi.edu/~rich/cetask/cea-2018-ext">
  <!--
  
   Dialog model for conversation between player and walrus (WalrusCave-PW)

   -->
  <say id="Convo" actor="walrus" text="Ah, you have come at last. Welcome, great emissaries, to my hall!">
    <say actor="player" text="Uh... hail, walrus! We seek the northern exit of your hall.">
      <say actor="walrus" text="What?! No one may exit the hall by the north gate unless they know the secret of the Hall.">
        <say actor="player" text="Well, it's been great talking to you, great tusk, but we really have to be going now.">
          <say actor="walrus" text="Not before you tell me the secret! I like the two of you, so here's a clue:">
            <say actor="walrus" text="Living threats your senses hone">
              <say actor="walrus" text="The frozen twin smiling is seated">
                <say actor="walrus" text="There upon a warming throne">
                  <say actor="walrus" text="But you must not, or be defeated">
                    <say actor="walrus" text="Bring forth the adamantly polished">
                      <say actor="walrus" text="Hidden when walls were breached">
                        <say id="Secret" actor="walrus" text="Now... what is the secret?">
			  <say actor="player" text="A hidden door?">
                            <say actor="walrus" text="I should say not!">
			      <say actor="walrus" ref="Secret"/>
			    </say>
                          </say>
                          <say actor="player" text="A diamond?">
                            <say id="AdamantRequest" actor="walrus" text="Aha! The Adamant Request! Well done.">
                              <do task="OpenExit"/>
                            </say>
                          </say>
                          <say actor="player" text="A whale?">
                            <say actor="walrus" text="Huh?">
			      <say actor="walrus" ref="Secret"/>
			    </say>
                          </say>
                        </say>
                      </say>
                    </say>
                  </say>
                </say>
              </say>
            </say>
          </say>
        </say>
      </say>
    </say>
  </say>
  
  <t:task id="OpenExit">
    <t:binding slot="$this.external" value="false"/>
    <t:precondition> !exitOpen() </t:precondition>
    <t:postcondition sufficient="true"> exitOpen() </t:postcondition>
    <t:script>
      world.get("walrus").getLocation().setLocation(disappearLocation);
    </t:script>
  </t:task>
  
  <t:script init="true">
    function exitOpen() { return world.get("walrus").getLocation().x &lt; 0; }
    disappearLocation = new Packages.java.awt.Point(-2, -2);
  </t:script>

</model>
