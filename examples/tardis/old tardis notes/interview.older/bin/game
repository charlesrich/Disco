#!/bin/sh
#
# Usage: game [ <filename> ] [ <path> ]
#
# Runs the given script file using GameConsole and compares resulting temporary log with
# corresponding test log file <filename>.test, if it exists.
# Optional <path> is added to class path (can only be used when first argument provided)
#
start=`date +%s`
dir=`dirname $0`/..
case `uname -s` in
  CYGWIN* ) 
    temp=`cygpath -w /tmp`
    ;;
  *)
    temp=/tmp
    ;;
esac
java -Djava.io.tmpdir="$temp" -cp lib/disco.jar edu.wpi.disco.game.GameConsole $1
end=`date +%s`
if [ "$1" ]; then
  good=$1.test
  if [ -f $good ]; then 
    # ignore comments and blank lines (Unix and Windows)
    diff -qwBI "^.$\|\#" $temp/`basename $1`.test $good
    diff=$?
    if [ $diff == 0 ]; then echo "Succeed" `basename $1` "("`expr $end - $start` "sec)" ; fi;
    exit $diff
  fi;
fi
